{
  "project": "Code Review Annotation Extension",
  "branchName": "ralph/code-review-extension",
  "description": "VSCode extension for inline code review annotations with categories, gutter icons, sidebar panel, and export to Markdown/HTML",
  "userStories": [
    {
      "id": "US-001",
      "title": "Initialize review storage structure",
      "description": "As a developer, I want the extension to create a .codereview/ directory to store annotations locally.",
      "acceptanceCriteria": [
        "Creates .codereview/ folder in workspace root on first comment",
        "Stores comments in .codereview/comments.json as JSON array",
        "Adds .codereview/ to .gitignore suggestion via optional prompt",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Define comment data types and storage service",
      "description": "As a developer, I need TypeScript types and a service to read/write comments.",
      "acceptanceCriteria": [
        "Comment interface with: id, filePath, startLine, endLine, text, category, createdAt, updatedAt",
        "Category type: 'bug' | 'question' | 'suggestion' | 'nitpick' | 'note'",
        "CommentStorage class with load(), save(), add(), update(), delete() methods",
        "Uses workspace.fs for file operations",
        "Generates UUID for comment IDs",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add comment command for single line",
      "description": "As a developer, I want to add a comment on a specific line via context menu or command palette.",
      "acceptanceCriteria": [
        "Register command 'codeReview.addComment'",
        "Right-click context menu shows 'Add Review Comment'",
        "Command palette includes 'Code Review: Add Comment'",
        "Keyboard shortcut Ctrl+Shift+R (Cmd+Shift+R on Mac)",
        "Input box prompts for comment text",
        "Quick pick shows categories: Bug, Question, Suggestion, Nitpick, Note",
        "Comment saved with current line number",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Add comment on line range selection",
      "description": "As a developer, I want to select multiple lines and add a comment spanning that range.",
      "acceptanceCriteria": [
        "When text is selected, context menu shows 'Add Review Comment'",
        "Comment stored with startLine and endLine from selection",
        "Single line selection sets startLine === endLine",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Display gutter icons for comments",
      "description": "As a developer, I want to see icons in the gutter for lines with comments.",
      "acceptanceCriteria": [
        "Gutter icon appears on lines with comments",
        "Icon color varies by category: Bug=red, Question=blue, Suggestion=green, Nitpick=orange, Note=gray",
        "Create SVG icons for each category",
        "Hovering gutter icon shows comment preview in tooltip",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Add inline text decorations",
      "description": "As a developer, I want inline visual cues showing comment category and preview.",
      "acceptanceCriteria": [
        "Line background subtly tinted by category color",
        "After-line decoration shows truncated comment text (max 50 chars)",
        "Uses TextEditorDecorationType for decorations",
        "Decorations update in real-time when comments change",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create sidebar tree view for comments",
      "description": "As a developer, I want a sidebar panel listing all comments grouped by file.",
      "acceptanceCriteria": [
        "Register activity bar icon for 'Code Review'",
        "TreeDataProvider implementation for comment tree",
        "Tree view grouped by file (parent nodes)",
        "Each comment shows: category icon, line number, truncated text",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Navigate to comment from sidebar",
      "description": "As a developer, I want to click a comment in sidebar to navigate to that line.",
      "acceptanceCriteria": [
        "Clicking comment item opens the file",
        "Cursor moves to the comment's startLine",
        "Line is revealed in center of editor",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Edit existing comment",
      "description": "As a developer, I want to edit a comment's text or category after creating it.",
      "acceptanceCriteria": [
        "Right-click comment in sidebar shows 'Edit Comment'",
        "Register command 'codeReview.editComment'",
        "Input box pre-filled with current text",
        "Category picker pre-selects current category",
        "updatedAt timestamp updated on save",
        "Decorations refresh after edit",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Delete comment",
      "description": "As a developer, I want to delete comments I no longer need.",
      "acceptanceCriteria": [
        "Right-click comment in sidebar shows 'Delete Comment'",
        "Register command 'codeReview.deleteComment'",
        "Confirmation prompt before deletion",
        "Gutter icon and decorations removed immediately",
        "Tree view refreshes after deletion",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Filter comments by category in sidebar",
      "description": "As a developer, I want to filter the sidebar to show only specific categories.",
      "acceptanceCriteria": [
        "Add filter button in sidebar header",
        "Quick pick shows: All, Bug, Question, Suggestion, Nitpick, Note",
        "Tree view updates to show only matching comments",
        "Filter state persists during session",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Implemented filter command with view/title menu button"
    },
    {
      "id": "US-012",
      "title": "Filter comments by file",
      "description": "As a developer, I want to show comments only for the current file.",
      "acceptanceCriteria": [
        "Add toggle button: 'Show All Files' / 'Current File Only'",
        "When 'Current File Only', tree shows only active editor's file",
        "Toggle updates tree view immediately",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Already implemented in US-010 thread - toggleFileFilter command with file icon button"
    },
    {
      "id": "US-013",
      "title": "Export comments to Markdown",
      "description": "As a developer, I want to export all comments to a Markdown file.",
      "acceptanceCriteria": [
        "Register command 'codeReview.exportMarkdown'",
        "Output file: .codereview/review-report.md",
        "Comments grouped by file with line numbers",
        "Shows category, comment text, timestamp",
        "Includes code snippet (3 lines before/after commented lines)",
        "Code snippets in fenced code blocks with language syntax",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Implemented exportMarkdown command with code snippets and language detection"
    },
    {
      "id": "US-014",
      "title": "Export comments to HTML",
      "description": "As a developer, I want to export comments to a styled HTML report.",
      "acceptanceCriteria": [
        "Register command 'codeReview.exportHtml'",
        "Output file: .codereview/review-report.html",
        "Styled with category colors",
        "Includes vscode:// protocol links to file:line",
        "Includes code snippet (3 lines before/after)",
        "Code snippets with inline CSS syntax highlighting",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Implemented with CDN-hosted highlight.js for syntax highlighting"
    },
    {
      "id": "US-015",
      "title": "Clear all comments command",
      "description": "As a developer, I want to clear all comments when starting fresh.",
      "acceptanceCriteria": [
        "Register command 'codeReview.clearAll'",
        "Confirmation dialog shows count of comments to delete",
        "Removes all entries from comments.json",
        "Clears all decorations and gutter icons",
        "Tree view refreshes to empty state",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Implemented clearAll command with confirmation dialog and proper cleanup"
    },
    {
      "id": "US-016",
      "title": "Handle file rename/move events",
      "description": "As a developer, I want comments to follow files when renamed or moved.",
      "acceptanceCriteria": [
        "Watch for workspace.onDidRenameFiles events",
        "Update filePath in comments.json for affected comments",
        "Decorations reapply to new file location",
        "Tree view updates with new file paths",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Implemented updateFilePaths method in CommentStorage and handleFileRename in commands.ts"
    }
  ]
}
